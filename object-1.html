<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ai Object Movement Based on hand gesture</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Inter', sans-serif; }
        canvas { display: block; }
        .glass-panel {
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .btn-option.active { background: #3b82f6; color: white; border-color: #60a5fa; }
        #webcam { transform: scaleX(-1); object-fit: cover; border-radius: 12px; }
        h1 { line-height: 1.2; }
    </style>
</head>
<body>

    <div id="loading-overlay" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-black text-white">
        <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
        <p class="tracking-widest animate-pulse uppercase text-xs">Calibrating AI Vision...</p>
    </div>

    <div class="absolute inset-0 pointer-events-none z-10 flex flex-col justify-between p-6">
        <div class="flex justify-between items-start pointer-events-auto">
            <div class="max-w-xs md:max-w-md">
                <h1 class="text-white text-xl md:text-3xl font-bold tracking-tight">Ai Object Movement <span class="text-blue-500">Based on hand gesture</span></h1>
                <div class="flex gap-4 mt-3">
                    <span class="text-[10px] text-blue-400 uppercase tracking-widest font-bold"><i class="fa-solid fa-hand"></i> Spread: Expand</span>
                    <span class="text-[10px] text-red-400 uppercase tracking-widest font-bold"><i class="fa-solid fa-hand-fist"></i> Fist: Compress</span>
                </div>
            </div>
            
            <div class="w-40 h-32 glass-panel p-1 rounded-xl hidden md:block">
                <video id="webcam" class="w-full h-full opacity-60" autoplay playsinline muted></video>
            </div>
        </div>

        <div class="pointer-events-auto self-center md:self-end">
            <div class="glass-panel rounded-3xl p-5 flex flex-col gap-4">
                <div class="flex items-center justify-between mb-1">
                    <span class="text-white text-[10px] font-bold uppercase tracking-widest opacity-50">Select Template</span>
                    <input type="color" id="color-picker" value="#00d4ff" class="w-8 h-8 rounded-full overflow-hidden border-none cursor-pointer">
                </div>
                <div class="grid grid-cols-5 gap-3">
                    <button class="btn-option active p-4 rounded-2xl bg-white/5 text-white transition-all hover:bg-white/10" onclick="changeShape('sphere')">
                        <i class="fa-solid fa-globe text-xl"></i>
                        <p class="text-[8px] mt-1">SPHERE</p>
                    </button>
                    <button class="btn-option p-4 rounded-2xl bg-white/5 text-white transition-all hover:bg-white/10" onclick="changeShape('butterfly')">
                        <i class="fa-solid fa-èšŠ text-xl"></i>
                        <i class="fa-solid fa-bug text-xl"></i>
                        <p class="text-[8px] mt-1">BUTTERFLY</p>
                    </button>
                    <button class="btn-option p-4 rounded-2xl bg-white/5 text-white transition-all hover:bg-white/10" onclick="changeShape('star')">
                        <i class="fa-solid fa-star text-xl"></i>
                        <p class="text-[8px] mt-1">STAR</p>
                    </button>
                    <button class="btn-option p-4 rounded-2xl bg-white/5 text-white transition-all hover:bg-white/10" onclick="changeShape('teddy')">
                        <i class="fa-solid fa-paw text-xl"></i>
                        <p class="text-[8px] mt-1">TEDDY</p>
                    </button>
                    <button class="btn-option p-4 rounded-2xl bg-white/5 text-white transition-all hover:bg-white/10" onclick="changeShape('fireworks')">
                        <i class="fa-solid fa-explosion text-xl"></i>
                        <p class="text-[8px] mt-1">BURST</p>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="canvas-container" class="w-full h-full"></div>

    <script type="module">
        import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
        import { FilesetResolver, HandLandmarker } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/+esm";

        const PARTICLE_COUNT = 15000;
        let TARGET_SCALE = 1.0;

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 10;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const geometry = new THREE.BufferGeometry();
        const posArray = new Float32Array(PARTICLE_COUNT * 3);
        const targetArray = new Float32Array(PARTICLE_COUNT * 3);

        for(let i=0; i<PARTICLE_COUNT; i++) {
            const phi = Math.acos(2 * Math.random() - 1);
            const theta = Math.random() * Math.PI * 2;
            targetArray[i*3] = 3 * Math.sin(phi) * Math.cos(theta);
            targetArray[i*3+1] = 3 * Math.sin(phi) * Math.sin(theta);
            targetArray[i*3+2] = 3 * Math.cos(phi);
        }

        geometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const material = new THREE.PointsMaterial({
            color: 0x00d4ff, size: 0.06, transparent: true, opacity: 0.8,
            blending: THREE.AdditiveBlending, depthWrite: false,
            map: new THREE.TextureLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/sprites/disc.png')
        });

        const points = new THREE.Points(geometry, material);
        scene.add(points);

        function getSpherePoint(radius, offsetX = 0, offsetY = 0, offsetZ = 0) {
            const phi = Math.acos(2 * Math.random() - 1);
            const theta = Math.random() * Math.PI * 2;
            return {
                x: radius * Math.sin(phi) * Math.cos(theta) + offsetX,
                y: radius * Math.sin(phi) * Math.sin(theta) + offsetY,
                z: radius * Math.cos(phi) + offsetZ
            };
        }

        window.changeShape = (shape) => {
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                let p = {x:0, y:0, z:0};
                if (shape === 'butterfly') {
                    const t = Math.random() * Math.PI * 2;
                    const r = Math.exp(Math.cos(t)) - 2 * Math.cos(4*t) + Math.pow(Math.sin(t/12), 5);
                    p.x = Math.sin(t) * r; p.y = Math.cos(t) * r; p.z = (Math.random()-0.5) * 2;
                } else if (shape === 'star') {
                    const r = Math.random() * 5;
                    const angle = (Math.floor(Math.random() * 5) / 5) * Math.PI * 2 + (r * 0.1);
                    p.x = Math.cos(angle) * r; p.y = Math.sin(angle) * r; p.z = (Math.random()-0.5);
                } else if (shape === 'teddy') {
                    const rand = Math.random();
                    if (rand < 0.4) p = getSpherePoint(2, 0, -1, 0); // Body
                    else if (rand < 0.7) p = getSpherePoint(1.3, 0, 1.5, 0); // Head
                    else if (rand < 0.8) p = getSpherePoint(0.5, -1, 2.5, 0); // Left Ear
                    else if (rand < 0.9) p = getSpherePoint(0.5, 1, 2.5, 0); // Right Ear
                    else p = getSpherePoint(0.6, (Math.random() > 0.5 ? 1.5 : -1.5), -2.5, 0); // Feet
                } else if (shape === 'fireworks') {
                    const r = 2 + Math.random() * 6;
                    p = getSpherePoint(r);
                } else {
                    p = getSpherePoint(3);
                }
                targetArray[i*3] = p.x; targetArray[i*3+1] = p.y; targetArray[i*3+2] = p.z;
            }
            document.querySelectorAll('.btn-option').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
        };

        async function startVision() {
            const vision = await FilesetResolver.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm");
            const handLandmarker = await HandLandmarker.createFromOptions(vision, {
                baseOptions: { modelAssetPath: "https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task", delegate: "GPU" },
                runningMode: "VIDEO", numHands: 1
            });
            document.getElementById('loading-overlay').remove();
            const video = document.getElementById('webcam');
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;
            video.addEventListener('loadeddata', () => {
                const predict = () => {
                    const results = handLandmarker.detectForVideo(video, performance.now());
                    if (results.landmarks && results.landmarks.length > 0) {
                        const lm = results.landmarks[0];
                        const d = Math.hypot(lm[12].x - lm[0].x, lm[12].y - lm[0].y);
                        TARGET_SCALE = d < 0.25 ? 0.2 : 2.0; 
                        points.rotation.y = (lm[9].x - 0.5) * -4;
                        points.rotation.x = (lm[9].y - 0.5) * 4;
                    }
                    requestAnimationFrame(predict);
                };
                predict();
            });
        }

        function animate() {
            const pos = geometry.attributes.position.array;
            for (let i = 0; i < PARTICLE_COUNT * 3; i++) {
                pos[i] += (targetArray[i] * TARGET_SCALE - pos[i]) * 0.1;
            }
            geometry.attributes.position.needsUpdate = true;
            points.rotation.y += 0.003;
            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }

        startVision();
        animate();
        document.getElementById('color-picker').addEventListener('input', (e) => material.color.set(e.target.value));
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>